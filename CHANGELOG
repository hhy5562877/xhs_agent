- [2026-02-20 23:20] FEAT: 图片生成支持 nano-banana 模型，根据模型名自动路由请求格式（nano-banana 用 aspect_ratio，其他模型用 size） (Files: src/xhs_agent/services/image_service.py)
- [2026-02-20 23:10] FEAT: 内容风格选项扩充至15个分类，新增"其他"选项支持手动输入自定义风格，封装 StyleSelect 组件复用于三处表单 (Files: frontend/src/App.tsx, static/)
- [2026-02-20 22:55] FIX: 修复 prompt_agent.py 兜底逻辑中残留的 image_styles 变量引用导致 NameError (Files: src/xhs_agent/agent/prompt_agent.py)
- [2026-02-20 19:30] FIX: 删除运营目标时同步取消调度器 pending job 并删除所有关联排期记录 (Files: src/xhs_agent/api/router.py, src/xhs_agent/services/goal_service.py)
- [2026-02-20 16:35] FEAT: 笔记图片风格统一化——整篇笔记只使用一种视觉风格（photo 或 poster），禁止混排；text_service SYSTEM_PROMPT 改为为整篇笔记决定统一风格；prompt_agent 所有图片只从同类模板中选不同子模板 (Files: src/xhs_agent/services/text_service.py, src/xhs_agent/agent/prompt_agent.py, src/xhs_agent/api/schemas.py, src/xhs_agent/agent/xhs_agent.py)
- [2026-02-20 16:30] CHORE: 从所有 git 历史中删除 .env 文件，将 log/ 目录加入 .gitignore (Files: .gitignore)
- [2026-02-20 18:10] FEAT: 日志补充完整提示词输出——所有 AI 请求（TextService/PromptAgent/ManagerAI）的 system_prompt 和 user_prompt 均写入 DEBUG 日志；get_user_all_notes 原始返回数据写入 DEBUG 日志 (Files: src/xhs_agent/services/text_service.py, src/xhs_agent/agent/prompt_agent.py, src/xhs_agent/services/manager_service.py, src/xhs_agent/services/upload_service.py)
- [2026-02-20 18:00] FIX: 修复 manager_service.py 硬编码模型名 "claude-opus-4-6" 导致 /api/goals/{id}/plan 500 错误，改为从配置读取 text_model；屏蔽 urllib3 DEBUG 日志噪音 (Files: src/xhs_agent/services/manager_service.py, main.py)
- [2026-02-20 17:55] FIX: 屏蔽 aiosqlite DEBUG 日志（每次 SQL 操作产生大量低价值输出），设为 WARNING 级别 (Files: main.py)
- [2026-02-20 16:40] FIX: 修复 middleware.py 中 logging.basicConfig() 抢占 root logger 导致文件日志失效的问题；HTTP 请求日志降为 DEBUG（body 详情只写文件），终端只显示简洁一行 INFO；goal_service.py 接入 prompt_agent，补充各阶段 DEBUG 日志 (Files: src/xhs_agent/middleware.py, src/xhs_agent/services/goal_service.py)
- [2026-02-20 16:26] FEAT: 新增图片提示词 Agent（prompt_agent.py），预设8种模板（4种photo/4种poster），LLM独立调用选模板+填充细节；改造 xhs_agent.py 串联 prompt_agent，修复 styles 未传递 bug；日志分级：终端 INFO，文件 DEBUG，补充关键节点 DEBUG 日志 (Files: src/xhs_agent/agent/prompt_agent.py, src/xhs_agent/agent/xhs_agent.py, src/xhs_agent/services/text_service.py, src/xhs_agent/services/image_service.py, main.py)
- [2026-02-20 17:30] FIX: 修复图片风格全为 photo 问题，重写 SYSTEM_PROMPT 按风格生成对应提示词；修复图片 API 空响应日志 (Files: src/xhs_agent/services/text_service.py, src/xhs_agent/services/image_service.py)
- [2026-02-20 17:10] FEAT: 账号管理新增 Cookie 有效性检查功能 (Files: src/xhs_agent/api/router.py, frontend/src/api.ts, frontend/src/App.tsx, static/)
- [2026-02-20 16:50] FEAT: 前端移除 Playwright 调试工具，清理相关 state/函数/import (Files: frontend/src/App.tsx)
- [2026-02-20 16:30] FEAT: 配置迁移至数据库，前端新增系统配置页面，移除 .env 依赖 (Files: src/xhs_agent/db.py, src/xhs_agent/config.py, src/xhs_agent/api/router.py, src/xhs_agent/services/text_service.py, src/xhs_agent/services/image_service.py, src/xhs_agent/services/notification_service.py, src/xhs_agent/services/manager_service.py, frontend/src/types.ts, frontend/src/api.ts, frontend/src/App.tsx, docker-compose.yml)
- [2026-02-20 14:00] CHORE: 降级 Python 要求至 3.12，重新生成 uv.lock (Files: .python-version, pyproject.toml, uv.lock)
- [2026-02-20 13:50] CHORE: Dockerfile 改为多阶段构建，集成前端构建，全面使用国内加速源 (Files: Dockerfile)
- [2026-02-20 13:30] CHORE: 添加 Docker 支持，移除 playwright 生产依赖 (Files: Dockerfile, docker-compose.yml, .dockerignore, pyproject.toml)
- [2026-02-20 12:54] FEAT: 多风格图片生成架构重构，支持 photo/poster 两种风格，AI 自动决策，并发独立生成每张图片 (Files: src/xhs_agent/api/schemas.py, src/xhs_agent/services/image_service.py, src/xhs_agent/services/text_service.py, src/xhs_agent/services/goal_service.py)
- [2026-02-20 14:40] FIX: 改进用户信息获取的错误处理，添加详细日志帮助诊断 Cookie 问题 (Files: src/xhs_agent/services/upload_service.py, src/xhs_agent/services/xhs_http.py)
- [2026-02-20 14:33] FIX: 修复 Cookie 域名设置问题，确保对所有小红书子域名有效；优化创作者中心 API 错误处理 (Files: src/xhs_agent/services/upload_service.py)
- [2026-02-20 14:27] FEAT: 集成 WxPusher 通知系统，支持笔记发布成功/失败通知 (Files: pyproject.toml, .env.example, src/xhs_agent/config.py, src/xhs_agent/services/notification_service.py, src/xhs_agent/services/goal_service.py)
- [2026-02-20 14:04] CHORE: 更新 .gitignore，忽略数据库文件、macOS 文件和环境配置文件 (Files: .gitignore)
- [2026-02-20 14:04] FEAT: XhsHttpClient 补全 API 接口：搜索笔记、笔记详情、评论、子评论、短链接、首页推荐 (Files: src/xhs_agent/services/xhs_http.py)
- [2026-02-20 14:04] FEAT: 优化图片提示词规则为"手机误拍感快照"风格，约100字详细描述 (Files: src/xhs_agent/services/text_service.py)
- [2026-02-20 14:04] CHORE: 添加 tenacity 依赖，清理旧 js/ 目录文件 (Files: pyproject.toml, uv.lock, js/)
- [2026-02-20 13:53] FIX: 修复 update_goal SQL 事务一致性问题，检查第一个 UPDATE 是否成功后再执行第二个 UPDATE (Files: src/xhs_agent/services/goal_service.py)
- [2026-02-20 13:53] FIX: 修复图片生成数量不足时的补齐逻辑，改为记录警告并返回实际数量，避免返回重复图片 (Files: src/xhs_agent/services/image_service.py)
- [2026-02-20 13:53] FEAT: 为图片生成添加宽高比无效值的警告日志 (Files: src/xhs_agent/services/image_service.py)
- [2026-02-20 13:53] REFACTOR: 重构模块导入方式，将本地 xhs/ 目录重命名为 xhs_tools/，移除 sys.path hack 代码 (Files: src/xhs_agent/services/upload_service.py, xhs/ -> xhs_tools/)
- [2026-02-20 15:00] FIX: 更新即梦4尺寸映射为官方2K规格，移除不支持的4:5比例 (Files: src/xhs_agent/services/image_service.py)
- [2026-02-20 14:45] FEAT: 更新即梦4尺寸映射为高清规格，提示词改为全中文约100字详细描述 (Files: src/xhs_agent/services/image_service.py, src/xhs_agent/services/text_service.py)
- [2026-02-20 14:30] FEAT: 图片提示词全部改为中文，严禁英文单词/字母/拼音，避免生成图片中出现英文 (Files: src/xhs_agent/services/text_service.py)
- [2026-02-20 14:15] FIX: 即梦4 n 参数类型改为整数，修复 500 类型错误 (Files: src/xhs_agent/services/image_service.py)
- [2026-02-20 14:00] FIX: 即梦4多图生成时在提示词中注入张数说明，避免只返回1张 (Files: src/xhs_agent/services/image_service.py)
- [2026-02-20 13:45] FEAT: 切换为即梦4 API，用 n 参数一次请求生成多张图片，移除并发单张请求 (Files: src/xhs_agent/services/image_service.py)
- [2026-02-20 13:30] FEAT: 图片生成模型切换为 doubao-seedream-4-5-251128，aspect_ratio 映射为 size 参数，去除水印 (Files: src/xhs_agent/services/image_service.py, .env)
- [2026-02-20 13:00] FEAT: 重写图片提示词风格为"iPhone误拍感快照"：无构图、运动模糊、局部过曝、杂乱背景 (Files: src/xhs_agent/services/text_service.py)
- [2026-02-20 12:45] FEAT: 图片提示词补充动态模糊感规则，文字元素强制中文、禁止英文 (Files: src/xhs_agent/services/text_service.py)
- [2026-02-20 12:30] FEAT: 优化图片提示词规则：iPhone 拍摄风格、只描述真实事物、避免文字、提示词改为英文 (Files: src/xhs_agent/services/text_service.py)
- [2026-02-20 12:00] FIX: 用 curl_cffi session 替换 xhs 包内部 requests session，修复上传接口 405 TLS 指纹问题 (Files: src/xhs_agent/services/upload_service.py)
- [2026-02-20 11:30] FIX: 编辑运营目标时同步更新该目标下所有 pending 排期的账号 (Files: src/xhs_agent/services/goal_service.py)
- [2026-02-20 11:00] FIX: 修复本地 xhs/ 目录遮蔽 pip 包导致 XhsClient 导入失败，清理 xhs/__init__.py 破损导入，用 sys.path 重排绕过本地目录 (Files: xhs/__init__.py, src/xhs_agent/services/upload_service.py)
- [2026-02-20 10:30] FEAT: XhsHttpClient 补全 API 接口：搜索笔记、笔记详情、评论、子评论、短链接、首页推荐 (Files: src/xhs_agent/services/xhs_http.py)
- [2026-02-20 10:00] FIX: 签名 JS 路径改为本地 xhs/js/xhs/，使用 xhs_xs_new.js 替代旧版 xhs_xs.js (Files: src/xhs_agent/services/upload_service.py)
- [2026-02-19 05:00] FEAT: Cookie 验证预览功能，账号列表展示真实头像/昵称/粉丝数 (Files: src/xhs_agent/db.py, src/xhs_agent/services/upload_service.py, src/xhs_agent/services/account_service.py, src/xhs_agent/api/router.py, frontend/src/types.ts, frontend/src/api.ts, frontend/src/App.tsx, static/)
- [2026-02-19 04:00] FEAT: 前端迁移至 React + Vite + Ant Design 6，静态构建输出到 static/ (Files: frontend/*, static/)
- [2026-02-19 03:00] FEAT: 账号管理功能
- [2026-02-19 02:00] FEAT: 优化图片提示词生成规则，要求中文文字入图、真实感、网感 (Files: src/xhs_agent/services/text_service.py)
- [2026-02-19 01:00] FEAT: 添加 API 请求日志中间件、小红书自动上传功能及前端一键发布按钮 (Files: main.py, src/xhs_agent/middleware.py, src/xhs_agent/services/upload_service.py, src/xhs_agent/api/router.py, static/index.html, utils/stealth.min.js, doc/API.md)
- [2026-02-19 00:00] FEAT: 初始化小红书 Agent 项目，实现文本+图片生成完整流程 (Files: main.py, pyproject.toml, .env.example, src/xhs_agent/config.py, src/xhs_agent/api/schemas.py, src/xhs_agent/api/router.py, src/xhs_agent/services/text_service.py, src/xhs_agent/services/image_service.py, src/xhs_agent/agent/xhs_agent.py, static/index.html, doc/API.md)
